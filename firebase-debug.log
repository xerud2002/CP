[debug] [2025-12-20T11:49:11.655Z] ----------------------------------------------------------------------
[debug] [2025-12-20T11:49:11.661Z] Command:       C:\Program Files\nodejs\node.exe C:\Users\cipri\AppData\Roaming\npm\node_modules\firebase-tools\lib\bin\firebase.js deploy --only firestore:indexes firestore:rules
[debug] [2025-12-20T11:49:11.661Z] CLI Version:   15.0.0
[debug] [2025-12-20T11:49:11.662Z] Platform:      win32
[debug] [2025-12-20T11:49:11.662Z] Node Version:  v22.16.0
[debug] [2025-12-20T11:49:11.662Z] Time:          Sat Dec 20 2025 11:49:11 GMT+0000 (Greenwich Mean Time)
[debug] [2025-12-20T11:49:11.662Z] ----------------------------------------------------------------------
[debug] 
[debug] [2025-12-20T11:49:11.664Z] >>> [apiv2][query] GET https://firebase-public.firebaseio.com/cli.json [none]
[debug] [2025-12-20T11:49:15.195Z] > command requires scopes: ["email","openid","https://www.googleapis.com/auth/cloudplatformprojects.readonly","https://www.googleapis.com/auth/firebase","https://www.googleapis.com/auth/cloud-platform"]
[debug] [2025-12-20T11:49:15.196Z] > authorizing via signed-in user (ciprian.rotopanescu@gmail.com)
[debug] [2025-12-20T11:49:15.196Z] [iam] checking project curierulperfect for permissions ["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]
[debug] [2025-12-20T11:49:15.196Z] Checked if tokens are valid: false, expires at: 1765815742824
[debug] [2025-12-20T11:49:15.197Z] Checked if tokens are valid: false, expires at: 1765815742824
[debug] [2025-12-20T11:49:15.197Z] > refreshing access token with scopes: []
[debug] [2025-12-20T11:49:15.198Z] >>> [apiv2][query] POST https://www.googleapis.com/oauth2/v3/token [none]
[debug] [2025-12-20T11:49:15.198Z] >>> [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-12-20T11:49:15.305Z] <<< [apiv2][status] POST https://www.googleapis.com/oauth2/v3/token 200
[debug] [2025-12-20T11:49:15.305Z] <<< [apiv2][body] POST https://www.googleapis.com/oauth2/v3/token [omitted]
[debug] [2025-12-20T11:49:15.324Z] >>> [apiv2][query] POST https://cloudresourcemanager.googleapis.com/v1/projects/curierulperfect:testIamPermissions [none]
[debug] [2025-12-20T11:49:15.324Z] >>> [apiv2][(partial)header] POST https://cloudresourcemanager.googleapis.com/v1/projects/curierulperfect:testIamPermissions x-goog-quota-user=projects/curierulperfect
[debug] [2025-12-20T11:49:15.324Z] >>> [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/curierulperfect:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[debug] [2025-12-20T11:49:15.444Z] <<< [apiv2][status] GET https://firebase-public.firebaseio.com/cli.json 200
[debug] [2025-12-20T11:49:15.444Z] <<< [apiv2][body] GET https://firebase-public.firebaseio.com/cli.json {"cloudBuildErrorAfter":1594252800000,"cloudBuildWarnAfter":1590019200000,"defaultNode10After":1594252800000,"minVersion":"3.0.5","node8DeploysDisabledAfter":1613390400000,"node8RuntimeDisabledAfter":1615809600000,"node8WarnAfter":1600128000000}
[debug] [2025-12-20T11:49:15.967Z] <<< [apiv2][status] POST https://cloudresourcemanager.googleapis.com/v1/projects/curierulperfect:testIamPermissions 200
[debug] [2025-12-20T11:49:15.967Z] <<< [apiv2][body] POST https://cloudresourcemanager.googleapis.com/v1/projects/curierulperfect:testIamPermissions {"permissions":["datastore.indexes.create","datastore.indexes.delete","datastore.indexes.list","datastore.indexes.update","firebase.projects.get"]}
[info] 
[info] === Deploying to 'curierulperfect'...
[info] 
[info] i  deploying firestore 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[info] i  firestore: ensuring required API firestore.googleapis.com is enabled... 
[debug] [2025-12-20T11:49:15.973Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:15.973Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:15.973Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default) [none]
[debug] [2025-12-20T11:49:16.121Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default) 200
[debug] [2025-12-20T11:49:16.121Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default) {"name":"projects/curierulperfect/databases/(default)","uid":"7ff09d75-2a03-4645-a0d4-72922334f8d2","createTime":"2025-03-30T19:51:47.032263Z","updateTime":"2025-03-30T19:51:47.032263Z","locationId":"europe-west2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-20T10:49:16.250689Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"g","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"INCw0sSMzJEDMKmEhMWlzowD"}
[info] i  firestore: reading indexes from firestore.indexes.json... 
[info] i  cloud.firestore: checking firestore.rules for compilation errors... 
[debug] [2025-12-20T11:49:16.123Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:16.123Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:16.123Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect:test [none]
[debug] [2025-12-20T11:49:16.123Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect:test [omitted]
[debug] [2025-12-20T11:49:16.898Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect:test 200
[debug] [2025-12-20T11:49:16.898Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect:test {}
[info] +  cloud.firestore: rules file firestore.rules compiled successfully 
[debug] [2025-12-20T11:49:16.899Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:16.900Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:16.900Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/curierulperfect/releases pageSize=10&pageToken=
[debug] [2025-12-20T11:49:17.559Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/curierulperfect/releases 200
[debug] [2025-12-20T11:49:17.559Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/curierulperfect/releases {"releases":[{"name":"projects/curierulperfect/releases/cloud.firestore","rulesetName":"projects/curierulperfect/rulesets/1b0d9249-bed5-4d0c-a017-970f1d0b96e4","createTime":"2025-03-30T19:51:52.779821Z","updateTime":"2025-12-16T19:32:49.220166Z"},{"name":"projects/curierulperfect/releases/firebase.storage/curierulperfect.firebasestorage.app","rulesetName":"projects/curierulperfect/rulesets/e2999e37-4994-4193-ad71-70676bada5fb","createTime":"2025-12-10T20:14:06.565572Z","updateTime":"2025-12-11T11:49:06.030006Z"}]}
[debug] [2025-12-20T11:49:17.575Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:17.576Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:17.576Z] >>> [apiv2][query] GET https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets/1b0d9249-bed5-4d0c-a017-970f1d0b96e4 [none]
[debug] [2025-12-20T11:49:18.269Z] <<< [apiv2][status] GET https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets/1b0d9249-bed5-4d0c-a017-970f1d0b96e4 200
[debug] [2025-12-20T11:49:18.269Z] <<< [apiv2][body] GET https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets/1b0d9249-bed5-4d0c-a017-970f1d0b96e4 [omitted]
[info] i  firestore: uploading rules firestore.rules... 
[debug] [2025-12-20T11:49:18.270Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.270Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.270Z] >>> [apiv2][query] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets [none]
[debug] [2025-12-20T11:49:18.270Z] >>> [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets [omitted]
[debug] [2025-12-20T11:49:18.635Z] <<< [apiv2][status] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets 200
[debug] [2025-12-20T11:49:18.636Z] <<< [apiv2][body] POST https://firebaserules.googleapis.com/v1/projects/curierulperfect/rulesets {"name":"projects/curierulperfect/rulesets/c7bda850-f7d2-4820-8fcf-aabf591ef386","source":{"files":[{"content":"rules_version = '2';\r\nservice cloud.firestore {\r\n  match /databases/{database}/documents {\r\n    \r\n    // Helper function to check if user is authenticated\r\n    function isAuthenticated() {\r\n      return request.auth != null;\r\n    }\r\n    \r\n    // Helper function to check if user is admin\r\n    function isAdmin() {\r\n      return isAuthenticated() && \r\n        get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';\r\n    }\r\n    \r\n    // Users collection - base profiles with role\r\n    match /users/{userId} {\r\n      allow read: if isAuthenticated();\r\n      allow create: if isAuthenticated() && request.auth.uid == userId;\r\n      allow update: if isAuthenticated() && (request.auth.uid == userId || isAdmin());\r\n      allow delete: if isAdmin(); // Only admin can delete users\r\n    }\r\n    \r\n    // Extended courier profiles\r\n    match /profil_curier/{userId} {\r\n      allow read: if isAuthenticated(); // Public read (clients need to see)\r\n      allow write: if isAuthenticated() && (userId == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Extended client profiles\r\n    match /profil_client/{userId} {\r\n      allow read: if isAuthenticated() && (userId == request.auth.uid || isAdmin());\r\n      allow write: if isAuthenticated() && (userId == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Courier coverage zones\r\n    match /zona_acoperire/{docId} {\r\n      allow read: if isAuthenticated();\r\n      allow create: if isAuthenticated() && request.resource.data.uid == request.auth.uid;\r\n      allow update, delete: if isAuthenticated() && (resource.data.uid == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Courier pricing\r\n    match /tarife_curier/{docId} {\r\n      allow read: if isAuthenticated();\r\n      allow create: if isAuthenticated() && request.resource.data.uid == request.auth.uid;\r\n      allow update, delete: if isAuthenticated() && (resource.data.uid == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Person transport routes\r\n    match /transport_persoane/{docId} {\r\n      allow read: if isAuthenticated();\r\n      allow create: if isAuthenticated() && request.resource.data.uid == request.auth.uid;\r\n      allow update, delete: if isAuthenticated() && (resource.data.uid == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Orders - simplified without status checks\r\n    match /comenzi/{docId} {\r\n      // Clients read own orders, couriers read all orders, admin reads everything\r\n      allow read: if isAuthenticated() && \r\n        (resource.data.uid_client == request.auth.uid || \r\n         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'curier' ||\r\n         isAdmin());\r\n      // Clients create orders\r\n      allow create: if isAuthenticated() && \r\n        request.resource.data.uid_client == request.auth.uid;\r\n      // Clients, couriers, and admin can update\r\n      allow update: if isAuthenticated() && \r\n        (resource.data.uid_client == request.auth.uid || \r\n         resource.data.courierId == request.auth.uid ||\r\n         get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'curier' ||\r\n         isAdmin());\r\n      // Clients can delete own orders, admin can delete any order\r\n      allow delete: if isAuthenticated() && \r\n        (resource.data.uid_client == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Reviews\r\n    match /recenzii/{docId} {\r\n      allow read: if isAuthenticated(); // Public read\r\n      allow create: if isAuthenticated() && \r\n        request.resource.data.clientId == request.auth.uid;\r\n      allow update, delete: if isAuthenticated() && \r\n        (resource.data.clientId == request.auth.uid || isAdmin());\r\n    }\r\n    \r\n    // Order number counter\r\n    match /counters/{counterId} {\r\n      allow read: if isAuthenticated();\r\n      allow write: if isAuthenticated(); // Needed for transactions\r\n    }\r\n    \r\n    // Messages - chat between client and couriers for orders\r\n    match /mesaje/{messageId} {\r\n      // Read: client who owns order OR courier assigned to order OR any courier (to see all opportunities)\r\n      allow read: if isAuthenticated();\r\n      \r\n      // Create: authenticated users (client or courier)\r\n      allow create: if isAuthenticated() && \r\n        request.resource.data.senderId == request.auth.uid;\r\n      \r\n      // Update/Delete: only message sender or admin\r\n      allow update, delete: if isAuthenticated() && \r\n        (resource.data.senderId == request.auth.uid || isAdmin());\r\n    }\r\n  }\r\n}\r\n","name":"firestore.rules"}]},"createTime":"2025-12-20T11:49:18.681903Z","metadata":{"services":["cloud.firestore"]}}
[debug] [2025-12-20T11:49:18.636Z] [rules] created ruleset projects/curierulperfect/rulesets/c7bda850-f7d2-4820-8fcf-aabf591ef386
[info] i  firestore: deploying indexes... 
[debug] [2025-12-20T11:49:18.641Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.641Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.641Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default)/collectionGroups/-/indexes [none]
[debug] [2025-12-20T11:49:18.875Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default)/collectionGroups/-/indexes 200
[debug] [2025-12-20T11:49:18.875Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default)/collectionGroups/-/indexes {"indexes":[{"name":"projects/curierulperfect/databases/(default)/collectionGroups/recenzii/indexes/CICAgLjy8IAK","queryScope":"COLLECTION","fields":[{"fieldPath":"courierId","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgNi47oMK","queryScope":"COLLECTION","fields":[{"fieldPath":"curierId","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgLjyuogK","queryScope":"COLLECTION","fields":[{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"timestamp","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgJiH2JAK","queryScope":"COLLECTION","fields":[{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgJjmiJEK","queryScope":"COLLECTION","fields":[{"fieldPath":"courierId","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgLiIjZIK","queryScope":"COLLECTION","fields":[{"fieldPath":"uid_client","order":"ASCENDING"},{"fieldPath":"timestamp","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgLjRnZMK","queryScope":"COLLECTION","fields":[{"fieldPath":"uid_client","order":"ASCENDING"},{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"timestamp","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/recenzii/indexes/CICAgNjp5ZMK","queryScope":"COLLECTION","fields":[{"fieldPath":"clientId","order":"ASCENDING"},{"fieldPath":"createdAt","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgLjywZkK","queryScope":"COLLECTION","fields":[{"fieldPath":"uid_client","order":"ASCENDING"},{"fieldPath":"status","order":"ASCENDING"},{"fieldPath":"__name__","order":"ASCENDING"}],"state":"READY","density":"SPARSE_ALL"},{"name":"projects/curierulperfect/databases/(default)/collectionGroups/comenzi/indexes/CICAgLix4JsK","queryScope":"COLLECTION","fields":[{"fieldPath":"courierId","order":"ASCENDING"},{"fieldPath":"timestamp","order":"DESCENDING"},{"fieldPath":"__name__","order":"DESCENDING"}],"state":"READY","density":"SPARSE_ALL"}]}
[debug] [2025-12-20T11:49:18.877Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.877Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.877Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* [none]
[debug] [2025-12-20T11:49:18.930Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* 200
[debug] [2025-12-20T11:49:18.930Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default)/collectionGroups/-/fields?filter=indexConfig.usesAncestorConfig=false OR ttlConfig:* {"fields":[{"name":"projects/curierulperfect/databases/(default)/collectionGroups/__default__/fields/*","indexConfig":{"indexes":[{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","order":"ASCENDING"}],"state":"READY"},{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","order":"DESCENDING"}],"state":"READY"},{"queryScope":"COLLECTION","fields":[{"fieldPath":"*","arrayConfig":"CONTAINS"}],"state":"READY"}]}}]}
[debug] [2025-12-20T11:49:18.930Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.930Z] Checked if tokens are valid: true, expires at: 1766234954305
[debug] [2025-12-20T11:49:18.930Z] >>> [apiv2][query] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default) [none]
[debug] [2025-12-20T11:49:18.982Z] <<< [apiv2][status] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default) 200
[debug] [2025-12-20T11:49:18.982Z] <<< [apiv2][body] GET https://firestore.googleapis.com/v1/projects/curierulperfect/databases/(default) {"name":"projects/curierulperfect/databases/(default)","uid":"7ff09d75-2a03-4645-a0d4-72922334f8d2","createTime":"2025-03-30T19:51:47.032263Z","updateTime":"2025-03-30T19:51:47.032263Z","locationId":"europe-west2","type":"FIRESTORE_NATIVE","concurrencyMode":"PESSIMISTIC","versionRetentionPeriod":"3600s","earliestVersionTime":"2025-12-20T10:49:19.114672Z","appEngineIntegrationMode":"DISABLED","keyPrefix":"g","pointInTimeRecoveryEnablement":"POINT_IN_TIME_RECOVERY_DISABLED","deleteProtectionState":"DELETE_PROTECTION_DISABLED","databaseEdition":"STANDARD","freeTier":true,"realtimeUpdatesMode":"REALTIME_UPDATES_MODE_ENABLED","etag":"IL+WgcaMzJEDMKmEhMWlzowD"}
[info] i  firestore: The following indexes are defined in your project but are not present in your firestore indexes file:
	(comenzi) -- (curierId,ASCENDING) (createdAt,DESCENDING)  -- Density:SPARSE_ALL  
